<app-system-base-layout
  title="Danh sách dữ liệu danh mục Cấu hình hệ thống"
  [showSearch]="showSearch"
  (triggerSearch)="applyFilter()"
  (clearSearch)="clearFilter()"
>
  <ng-container ngProjectAs="header-actions">
    <button mat-stroked-button color="primary" (click)="toggleSearch()">
      <mat-icon>search</mat-icon>
      Tìm kiếm
    </button>
    <button mat-flat-button color="primary" (click)="addNew()">
      <mat-icon>person_add</mat-icon>
      Thêm mới
    </button>
    <button mat-flat-button color="warn" *ngIf="selection.hasValue()" (click)="deleteSelected()">
      <mat-icon>delete</mat-icon>
      Xoá người dùng
    </button>
    <button mat-stroked-button color="primary">
      <mat-icon>account_circle</mat-icon>
      Gen người dùng
    </button>
    <button mat-stroked-button color="primary">
      <mat-icon>grid_on</mat-icon>
      Xuất Excel
    </button>
    <button mat-stroked-button color="warn" (click)="clearFilter()">
      <mat-icon>close</mat-icon>
      Quay lại
    </button>
  </ng-container>
  <ng-container ngProjectAs="search-fields">
    <div class="search-fields">
      <mat-form-field appearance="outline" class="field">
        <mat-label>Họ tên</mat-label>
        <input matInput [(ngModel)]="fullNameQuery" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="field">
        <mat-label>Tên tài khoản</mat-label>
        <input matInput [(ngModel)]="usernameQuery" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="field">
        <mat-label>Đơn vị</mat-label>
        <input matInput [(ngModel)]="unitQuery" />
      </mat-form-field>
      <mat-form-field appearance="outline" class="field">
        <mat-label>Email</mat-label>
        <input matInput [(ngModel)]="emailQuery" />
      </mat-form-field>
    </div>
  </ng-container>
  <ng-container>
    <div>
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z0">
        <!-- Select Checkbox Column -->
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox
              color="primary"
              (change)="masterToggle()"
              [checked]="isAllSelected()"
              [indeterminate]="selection.hasValue() && !isAllSelected()"
              [aria-label]="checkboxLabel()"
            >
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox
              color="primary"
              (click)="$event.stopPropagation()"
              (change)="selection.toggle(row)"
              [checked]="selection.isSelected(row)"
              [aria-label]="checkboxLabel(row)"
            >
            </mat-checkbox>
          </td>
        </ng-container>

        <!-- Index Column -->
        <ng-container matColumnDef="index">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>#</th>
          <td mat-cell *matCellDef="let element; let i = index">{{ i + 1 }}</td>
        </ng-container>

        <!-- Actions Column with dropdown -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Thao tác</th>
          <td mat-cell *matCellDef="let row">
            <button mat-stroked-button color="primary" [matMenuTriggerFor]="actionMenu">
              Thao tác
              <mat-icon>arrow_drop_down</mat-icon>
            </button>
            <mat-menu #actionMenu="matMenu">
              <button mat-menu-item (click)="onResetPassword(row)">
                <mat-icon>vpn_key</mat-icon>
                <span>Reset Password</span>
              </button>
              <button mat-menu-item (click)="onEdit(row)">
                <mat-icon>edit</mat-icon>
                <span>Sửa thông tin</span>
              </button>
              <button mat-menu-item (click)="onAssignRole(row)">
                <mat-icon>admin_panel_settings</mat-icon>
                <span>Phân vai trò</span>
              </button>
              <button mat-menu-item (click)="onPersonalPermission(row)">
                <mat-icon>settings</mat-icon>
                <span>Phân quyền cá nhân</span>
              </button>
              <button mat-menu-item (click)="onDelete(row)">
                <mat-icon color="warn">delete</mat-icon>
                <span>Xóa người dùng</span>
              </button>
              <button mat-menu-item (click)="onAutoLockConfig(row)">
                <mat-icon>event_busy</mat-icon>
                <span>Cấu hình khóa tự động</span>
              </button>
              <button mat-menu-item (click)="onLockAccount(row)">
                <mat-icon>lock</mat-icon>
                <span>Khóa tài khoản</span>
              </button>
              <button mat-menu-item (click)="onViewLockLogs(row)">
                <mat-icon>receipt_long</mat-icon>
                <span>Tra cứu log khóa tự động</span>
              </button>
              <button mat-menu-item (click)="onAssignManagementUnit(row)">
                <mat-icon>assignment_ind</mat-icon>
                <span>Gán đơn vị quản lý</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <!-- FullName Column -->
        <ng-container matColumnDef="fullName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Họ tên</th>
          <td mat-cell *matCellDef="let element">{{ element.fullName }}</td>
        </ng-container>

        <!-- Username Column -->
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Tên tài khoản</th>
          <td mat-cell *matCellDef="let element">{{ element.username }}</td>
        </ng-container>

        <!-- Unit Column -->
        <ng-container matColumnDef="unit">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Đơn vị</th>
          <td mat-cell *matCellDef="let element">{{ element.unit }}</td>
        </ng-container>

        <!-- Email Column -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
          <td mat-cell *matCellDef="let element">{{ element.email }}</td>
        </ng-container>

        <!-- Phone Column -->
        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Điện thoại</th>
          <td mat-cell *matCellDef="let element">{{ element.phone }}</td>
        </ng-container>

        <!-- DOB Column -->
        <ng-container matColumnDef="dob">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Ngày sinh</th>
          <td mat-cell *matCellDef="let element">{{ element.dob }}</td>
        </ng-container>

        <!-- Gender Column -->
        <ng-container matColumnDef="gender">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Giới tính</th>
          <td mat-cell *matCellDef="let element">{{ element.gender }}</td>
        </ng-container>

        <!-- Address Column -->
        <ng-container matColumnDef="address">
          <th mat-header-cell *matHeaderCellDef>Địa chỉ</th>
          <td mat-cell *matCellDef="let element">{{ element.address }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <mat-paginator [pageSize]="20" [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons>
      </mat-paginator>
    </div>
  </ng-container>
</app-system-base-layout>
